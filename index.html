<!DOCTYPE html>
<html>
	<head>
		<title>Wiseguy</title> 
		
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta content="minimum-scale=1.0, width=device-width, maximum-scale=0.6667, user-scalable=no" name="viewport" />
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
		<meta content="yes" name="apple-mobile-web-app-capable" />
		<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type" />
		<link rel="apple-touch-icon" href="img/icon.png"/>
		
		<link rel="stylesheet" type="text/css" href="style.css"/>
		<link rel="stylesheet" type="text/css" href="carbon.css"/>
		
		<script language="JavaScript" type="text/javascript" src="javascript/moment.min.js"></script>
		<script language="JavaScript" type="text/javascript" src="javascript/mustache.js"></script>	
		<script language="JavaScript" type="text/javascript" src="javascript/carbon.js"></script>
		<script language="JavaScript" type="text/javascript" src="javascript/jquery-2.1.3.min.js"></script> 
		<script language="JavaScript" type="text/javascript" src="javascript/tinysort.js"></script>
		
	</head>
	
	<body>
	
	
	
		<!--TREE PAGE -------------->
			<div id="tree" class="page" style="display:block;">
			  
			<div id="header">
				<div class="menu-title">Root</div>
				<img class="search-button" src="img/search-icon.png"  style="float:right; margin:5px; cursor:pointer;"/>
			</div> <!--end header-->
			
			<!--Sub-meny-->
			<div class="submenu">
				<button class="back-button">Back</button>
				<button class="new-button">New</button>
				
			</div><!-- end controls-->
			
			<!-- Projektlista -->
			<div id="items">
				<input class="search" placeholder="Search"  style="display:none;"/>
				<div id="open"></div>
				<div id="finished"></div>
			</div><!-- end items--> 
			
		</div><!-- end page-->

		
		
		<!--SEARCH PAGE -------------->
			<div id="search" class="page" style="display:block;">
			  
			<div id="header">
				<div style="float:left;">Search</div>
				<img class="cancel-button" src="img/tree-icon.png"  style="float:right; margin:5px; cursor:pointer;"/>
			</div> <!--end header-->
			
			<!--Sub-meny-->
			<div class="submenu">
				<select class="type-filter" onchange="itemList.filtered(this.value); console.log('hej');">
					<option value="all">-ALL-</option>
					<option value="6">-General Task</option>
               <option value="14">-Home</option>
        			<option value="9">-Telephone</option>
					<option value="10">-Computer</option>
               <option value="11">-Away</option>
               <option value="12">-Planning</option>
					<option value="4">-Idea</option>
               <option value="5">-Problem</option>
					<option value="7">-Project</option> 
					<option value="13">-Category</option> 
					<option value="100">-Document</option>  
					<option disabled>Programming:</option>
					<option value="1">-Coding</option>  
					<option value="2">-Sketch</option>
					<option value="3">-Solve</option>
					<option value="8">-Page</option>  
				</select>
				
				<input class="search" onkeyup="search(this.value);" placeholder="Search" style="width:100px;"/>
			</div><!-- end controls-->
			
			<!-- ItemLista -->
			<div id="items">
				<div id="filtered"></div>
			</div><!-- end items--> 
			
		</div><!-- end page-->
		
		
		
		<!-- EDIT item ---------------------------------------------------------------------->
		<div id="edit" class="page">
			
			<div id="header">
				<div class="menu-title">-item-title-</div>
			</div> <!--end header-->
			
			<!--Sub-meny-->
			<div class="submenu">
				<button class="back-button">Cancel</button>
				<button class="save-button" style="width:70px; float:right;margin-left:5px;"><img src="img/save.png" /></button>
				<button class="delete-button" style="width:70px; float:right;margin-left:5px;"><img src="img/delete2.png" /></button>
				<button class="finish-button" style="width:70px; float:right;margin-left:5px;"><img src="img/finish.gif" /></button>
				<br/><br/>
			</div><!-- end controls--> 
			
			<form id="edit-item-form">
				<input class="item-title" name="title" type="text" style="margin-bottom:5px;height:50px; font-size:1.3em"/><br/>
				
				<select class="item-prio" name="prio" style="margin-bottom:5px;height:40px;">
					<option value="1">Prio 1</option>
					<option value="2">Prio 2</option>
					<option value="3">Prio 3</option>
					<option value="4">Prio 4</option>
					<option value="5">Prio 5</option>
				</select><br/>
				
				<select class="item-type" name="type" style="margin-bottom:5px;height:40px;">
					<option value="6">-General Task</option>
                    <option value="14">-Home</option>
        			<option value="9">-Telephone</option>
					<option value="10">-Computer</option>
                    <option value="11">-Away</option>
                    <option value="12">-Planning</option>
					<option value="4">-Idea</option>
                    <option value="5">-Problem</option>
					<option value="7">-Project</option> 
					<option value="13">-Category</option> 
					<option value="100">-Document</option>  
					<option disabled>Programming:</option>
					<option value="1">-Coding</option>  
					<option value="2">-Sketch</option>
					<option value="3">-Solve</option>
					<option value="8">-Page</option>  
				</select><br/>
				
				<select class="item-size" name="size" style="margin-bottom:5px;height:40px;">
					<option value="0">--Set size--</option>
					<option value="1">Quick (5min)</option>
					<option value="2">Small (<15min)</option>
					<option value="3">Medium (<1h)</option>
					<option value="4">Large (<3h)</option>
					<option value="5">XLarge (>3h)</option>
				</select><br/>
				
				<textarea class="item-notes" name="notes" rows="5" placeholder="Notes"></textarea>
				
				<center>
					<button class="more-button" type='button'>More options</button>
				</center>
				<div class="more" style="display:none;">
					<span class="field-description">id:</span>
					<input class="item-id" name="id" type="text" readonly="readonly" style="color:#CCC;"/> <br/>
					<span class="field-description">parent_id:</span>
					<input class="item-parent-id" name="parent_id" type="text" style="margin-bottom:5px;"/><br/>
					<span class="field-description">parent_id:</span>
					<input class="finish_date" name="finish_date" type="datetime-local" style="margin-bottom:5px;height:40px; font-size:1.1em"/><br/>
				</div>
				
			</form>
		</div><!--edit-item--> 

		<!-- NEW item--------------------------------------------------------------------------->
		<div id="new" class="page">
			
			<div id="header">
				<div class="menu-title">-new item-</div>
			</div> <!--end header-->
			
			<!--Sub-meny-->
			<div class="submenu">
				<button class="cancel-button">Cancel</button>
				<button class="add-button">Add</button>
			</div><!-- end controls--> 
			
			
			
			<form id="new-item-form">
				<textarea  id="new-item-title" name="title" placeholder="Title" rows="1"></textarea><br/>
			
				<select id="new-item-prio" name="prio" style="margin-bottom:5px;height:40px;">
					<option value="1">Prio 1</option> 
					<option value="2">Prio 2</option> 
					<option value="3" selected="selected">Prio 3</option> 
					<option value="4">Prio 4</option> 
					<option value="5">Prio 5</option>
				</select><br/>
				
				<select id="new-item-type" name="type" style="margin-bottom:5px;height:40px;">
					<option value="6">-General Task</option>
                    <option value="14">-Home</option>
        			<option value="9">-Telephone</option>
					<option value="10">-Computer</option>
                    <option value="11">-Away</option>
                    <option value="12">-Planning</option>
					<option value="4">-Idea</option>
                    <option value="5">-Problem</option>
					<option value="7">-Project</option> 
					<option value="13">-Category</option> 
					<option value="100">-Document</option>  
					<option disabled>Programming:</option>
					<option value="1">-Coding</option>  
					<option value="2">-Sketch</option>
					<option value="3">-Solve</option>
					<option value="8">-Page</option>  
				</select>
				
				 <select id="new-item-size" name="size" style="margin-bottom:5px;height:40px;">
					<option value="0" selected>--Set size--</option>
					<option value="1">Quick (5min)</option>
					<option value="2">Small (<15min)</option>
					<option value="3">Medium (<1h)</option>
					<option value="4">Large (<3h)</option>
					<option value="5">XLarge (>3h)</option>
				</select><br/>
				
				<textarea id="new-item-notes" name="notes" placeholder="Notes" rows="5"></textarea>
				
				<input type="hidden" name="parent_id" id="new-parent-id" value="0"/>
				<input type="hidden" name="status" value="open" placeholder="Status" style="margin-bottom:5px;"/>
				
			</form>
			<br/><br/><br/><br/><br/><br/><br/>
		</div><!-- end new-item--> 
	
	</body>
</html>



<!-- MENU >
		<div id="menu" class="page">
			
			<div id="header">
				<div class="menu-title">MENU</div>
				<img class="cancel-button" src="img/menu-button.png"  style="float:right; margin:5px;"/>
			</div> <!--end header-->
			<!--span style="color:white;">These functions are experimental, use with caution!</span> <br/>
			<button onclick="if (confirm('Previous data will be erased!')==true) {itemList.cleardata(); view_item(0);}" style="margin:10px;">Clear data</button><br/>
			<button onclick="if (confirm('Previous data will be erased!')==true) {itemList.testdata(); itemList.refresh(0);view_item(0);}" style="margin:10px;">Test data (50000 randomized items)</button><br/>
			<button class="search-button" style="margin:10px;">Search</button>
		</div><!-- end menu--> 
	
	</body>
</html>



<!-- Mustache template öppna-->
<script id="open_items_template" type="text/template">
	<div class="subitem project">
						
		<div class="subitem-left quick_edit_item">
			<img class="prio-icon" src="img/prio{{prio}}.png"/>
			<img class="type-icon" style="margin:4px 7px;" src="img/type{{type}}.png"/>
			<img class="type-icon" style="margin:0;" src="img/size{{size}}.png"/>
		</div>
		
		<div class="subitem-center">
			<div class="title" style="">{{title}}</div>
			<div class="next_action_div" style="float:left;">
				{{#notes}}<span class="notes">{{notes}}</span>{{/notes}}
				{{#subitems}}
					<img style="margin:4px 0px 4px 5px;height:10px;vertical-align: text-top;" src="img/type{{type}}.png"/>
					<span class="next_action">{{title}}</span><br/>  
				{{/subitems}}
			</div>
		</div><!-- end subitem-center -->
		 
		<div style="clear:both;"></div>
		
		<span class="item_id" style="display:none;">{{id}}</span>
		<span class="prio" style="display:none;">{{prio}}</span>
		<span class="type" style="display:none;">{{type}}</span>
		<span class="size" style="display:none;">{{size}}</span>
	
	</div><!-- end subitem  -->
</script>	
	
	
<!-- Mustache template avslutade -->
<script id="finished_items_template" type="text/template">
	<div class="subitem finished project">
						
		<div class="subitem-left quick_edit_item">
			<img class="prio-icon" src="img/prio{{prio}}.png"/>
			<img class="type-icon" style="margin:4px 7px;" src="img/type{{type}}.png"/>
			<img class="type-icon" style="margin:0;" src="img/size{{size}}.png"/>
		</div>
		
		<div class="subitem-center">
			<div class="title" style="">{{title}}</div>
			<div class="next_action_div" style="float:left;">
				<span class="next_action">{{finish_date}}</span>
				{{#notes}}<span class="notes">{{notes}}</span>{{/notes}}
				
			</div>
		</div><!-- end subitem-center -->
		 
		<div style="clear:both;"></div>
		
		<span class="item_id" style="display:none;">{{id}}</span>
		<span class="prio" style="display:none;">{{prio}}</span>
		<span class="type" style="display:none;">{{type}}</span>
	
	</div><!-- end subitem  -->
</script>	
	
	
<!-- Mustache template search -->
<script id="filtered_items_template" type="text/template">
	<div class="subitem project">
						
		<div class="subitem-left quick_edit_item">
			<img class="prio-icon" src="img/prio{{prio}}.png"/>
			<img class="type-icon" style="margin:4px 7px;" src="img/type{{type}}.png"/>
			<img class="type-icon" style="margin:0;" src="img/size{{size}}.png"/>
		</div>
		
		<div class="subitem-center">
			<div class="title" style="">{{title}}</div>
			{{#path}}<div class="path" style="">{{path}}</div>{{/path}}
			<div class="next_action_div" style="float:left;">
				<span class="next_action">{{finish_date}}</span>
				{{#notes}}<span class="notes">{{notes}}</span>{{/notes}}
				
			</div>
		</div><!-- end subitem-center -->
		 
		<div style="clear:both;"></div>
		
		<span class="item_id" style="display:none;">{{id}}</span>
		<span class="prio" style="display:none;">{{prio}}</span>
		<span class="type" style="display:none;">{{type}}</span>
	
	</div><!-- end subitem  -->
</script>	
	
	
<!-- Navigerings script -->	
<script>
	
	// Uppstart
	var current = {id:0, parent_id:0, title:"Alla"};
	itemList.init("key");
	if (itemList.itemArray==undefined) itemList.exampledata();
	itemList.filtered("all");
	view_item(0);
	

	// .subitem-left (visa edit-läge)
	$(document).on('click', ".subitem-left", function() {
		
		var current_id = $(this).parent().find(".item_id").text();
		current = itemList.get_item(current_id);
    
		$(".menu-title").html("Edit: "+current.title);
		
     	$("input.item-id").val(current_id);
     	$("input.item-title").val(current.title);
     	$("textarea.item-notes").val(current.notes);
		$(".item-prio").val(current.prio);
     	$(".item-type").val(current.type);
     	$(".item-size").val(current.size);
 		$(".finish_date").val(current.finish_date);
     	$("input.item-parent-id").val(current.parent_id);
		
			/*$("input.item-category").val(current.category);
        $("input.item-create-date").val(current.date_create);
        $("input.item-finish-date").val(current.date_finished);*/
				
		$(".page").hide();
		$("#edit").show();
		
		$('.more').hide();
		$('.more-button').show();
    });
    
	
	// .subitem-center (visa subitems)
	$(document).on('click', ".subitem-center", function() {
		var current_id = $(this).parent().find(".item_id").text();
		view_item (current_id);
    });
    
    
    
	// .new-button
	$(document).on('click', ".new-button", function() {
 
		$(".menu-title").html("New: "+current.title);
      $("input.item-id").val(current.id);
      $("#new-item-title").val("");
      $("#new-item-prio").val("2");
      //$("#new-item-type").val("6");   // visar senaste om bortkommenterad
      $("#new-item-notes").val("");
      $("#new-item-size").val("0");
      $("#new-parent-id").val(current.id);
		
		$(".page").hide();
		$("#new").show();
    });
	
	// .add-button
	$(document).on('click', ".add-button", function() {
        itemList.add_from_form("#new-item-form");
		view_item(current.id);
    });
	
	
	// .save-button
	$(document).on('click', ".save-button", function() {
        itemList.edit_from_form("#edit-item-form");
		view_item(current.parent_id);
		
    });
	
	
	// .more-button
	$(document).on('click', ".more-button", function() {
		$('.more').show();
		$('.more-button').hide();
    });
	
	// .back-button
    $(document).on('click', ".back-button", function() {
		view_item(current.parent_id);
    });

	// .cancel-button
    $(document).on('click', ".cancel-button", function() {
        view_item(current.id);
    });
	
	// .delete-button
    $(document).on('click', ".delete-button", function() {
		
		if (confirm('Delete "'+current.title+'"?')==true) {
            itemList.remove_item(current.id);
			view_item(current.parent_id);
		}
    });
    
    // .finish-button
	$(document).on('click', ".finish-button", function() {
         itemList.finish_item(current.id);
			view_item(current.parent_id);
    });
	

	// .menu-button
    $(document).on('click', ".menu-button", function() {
        	$(".page").hide();
			$("#menu").show();
    });
	
	
	// .search-button
	$(document).on('click', ".search-button", function() {
		$(".page").hide();
		$("#search").show();
    });

	
	function view_item (id) {
		current = itemList.get_item(id);
		itemList.refresh(id);
		$(".menu-title").html(current.title);
		$(".menu-path").html(itemList.get_path(current.id));
		if(current.id == 0) $("#tree>.submenu>.back-button").hide(); 
		else $("#tree>.submenu>.back-button").show();
	
		$(".page").hide();
		$("#tree").show();
	}
	
	//search
    function search(query){
        $("#filtered>.subitem").show();
        if(query!="") $("#filtered>.subitem>.subitem-center>.title:not(:contains('"+query+"'))").parent().parent().hide();
        else $("#filtered>.subitem").show();
    };
    
	
</script>
